---
identifier: "CVE-2023-31146"
identifiers:
- "CVE-2023-31146"
- "GHSA-3p37-3636-q8wv"
package_slug: "pypi/vyper"
title: "Vyper vulnerable to OOB DynArray access when array is on both LHS and RHS
  of an assignment"
description: "during codegen, the length word of a dynarray is written before the
  data, which can result in OOB array access in the case where the dynarray is on
  both the lhs and rhs of an assignment. here is a minimal example producing the issue:\n```vyper\na:DynArray[uint256,3]\n@external\ndef
  test() -> DynArray[uint256,3]:\nself.a = [1,2,3]\nself.a = empty(DynArray[uint256,3])\nself.a
  = [self.a[0],self.a[1],self.a[2]]\nreturn self.a # return [1,2,3]\n```\n\nand here
  is an example demonstrating the issue can cause data corruption across call frames:\n\n```vyper\n@external\ndef
  test() -> DynArray[uint256,3]:\nself.a()\nreturn self.b() # return [1,2,3]\n\n@internal\ndef
  a():\na: uint256 = 0\nb: uint256 = 1\nc: uint256 = 2\nd: uint256 = 3\n\n@internal\ndef
  b() -> DynArray[uint256,3]:\na: DynArray[uint256,3] = empty(DynArray[uint256,3])\na
  = [a[0],a[1],a[2]]\nreturn a\n```\n\nexamples involving append and pop:\n```vyper\n@internal\ndef
  foo():\nc: DynArray[uint256, 1] = []\nc.append(c[0])\n```\n\n```vyper\n@internal\ndef
  foo():\nc: DynArray[uint256, 1] = [1]\nc[0] = c.pop()\n```\n\nthe expected behavior
  in all of the above cases is to revert due to oob array access."
date: "2024-11-19"
pubdate: "2023-05-12"
affected_range: "<0.3.8"
fixed_versions:
- "0.3.8"
affected_versions: "All versions before 0.3.8"
not_impacted: "All versions starting from 0.3.8"
solution: "Upgrade to version 0.3.8 or above."
urls:
- "https://nvd.nist.gov/vuln/detail/CVE-2023-31146"
- "https://github.com/advisories/GHSA-3p37-3636-q8wv"
- "https://github.com/vyperlang/vyper/security/advisories/GHSA-3p37-3636-q8wv"
- "https://github.com/vyperlang/vyper/commit/4f8289a81206f767df1900ac48f485d90fc87edb"
- "https://github.com/pypa/advisory-database/tree/main/vulns/vyper/PYSEC-2023-77.yaml"
- "https://github.com/vyperlang/vyper"
cvss_v3: "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:H"
uuid: "ac40d968-9442-42b7-83df-85a4be1fccb1"
cwe_ids:
- "CWE-787"
- "CWE-937"
- "CWE-1035"
