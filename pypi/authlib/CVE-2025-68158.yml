---
identifier: "CVE-2025-68158"
identifiers:
- "CVE-2025-68158"
- "GHSA-fg6f-75jq-6523"
package_slug: "pypi/authlib"
title: "Authlib has 1-click Account Takeover vulnerability"
description: "I am writing to you from the Security Labs team at Snyk to report a
  security issue affecting Authlib, which we identified during a recent research project.\n\nWe
  have identified a vulnerability that can result in a 1-click Account Takeover in
  applications that use the Authlib library. (5.7 CVSS v3: AV:N/AC:L/PR:L/UI:R/S:U/C:H/I:N/A:N)\n\n**Description**\n\nCache-backed
  state/request-token storage is not tied to the initiating user session, so CSRF
  is possible for any attacker that has a valid state (easily obtainable via an attacker-initiated
  authentication flow). When a cache is supplied to the OAuth client registry, `FrameworkIntegration.set_state_data`
  writes the entire state blob under `_state_{app}_{state},` and `get_state_data`
  ignores the caller’s session altogether. \\[1\\]\\[2\\]\n\n```py\ndef _get_cache_data(self,
  key):\nvalue = self.cache.get(key)\nif not value:\nreturn None\ntry:\nreturn json.loads(value)\nexcept
  (TypeError, ValueError):\nreturn None\n[snip]\ndef get_state_data(self, session,
  state):\nkey = f\"_state_{self.name}_{state}\"\nif self.cache:\nvalue = self._get_cache_data(key)\nelse:\nvalue
  = session.get(key)\nif value:\nreturn value.get(\"data\")\nreturn None\n```\n\n*authlib/integrations/base\\_client/framework\\_integration.py:12-41*\n\nRetrieval
  in authorize\\_access\\_token therefore succeeds for whichever browser presents
  that opaque value, and the token exchange proceeds with the attacker’s authorization
  code. \\[3\\]\n\n```py\ndef authorize_access_token(self, **kwargs):\n\"\"\"Fetch
  access token in one step.\n\n:return: A token dict.\n\"\"\"\nparams = request.args.to_dict(flat=True)\nstate
  = params.get(\"oauth_token\")\nif not state:\nraise OAuthError(description='Missing
  \"oauth_token\" parameter')\n\ndata = self.framework.get_state_data(session, state)\nif
  not data:\nraise OAuthError(description='Missing \"request_token\" in temporary
  data')\n\nparams[\"request_token\"] = data[\"request_token\"]\nparams.update(kwargs)\nself.framework.clear_state_data(session,
  state)\ntoken = self.fetch_access_token(**params)\nself.token = token\nreturn token\n```\n\n*authlib/integrations/flask\\_client/apps.py:57-76*\n\nThis
  opens up the avenue for Login CSRF for apps that use the cache-backed storage. Depending
  on the dependent app’s implementation (whether it somehow links accounts in the
  case of a login CSRF), this could lead to account takeover."
date: "2026-01-09"
pubdate: "2026-01-08"
affected_range: "<1.6.6"
fixed_versions:
- "1.6.6"
affected_versions: "All versions before 1.6.6"
not_impacted: "All versions starting from 1.6.6"
solution: "Upgrade to version 1.6.6 or above."
urls:
- "https://nvd.nist.gov/vuln/detail/CVE-2025-68158"
- "https://github.com/advisories/GHSA-fg6f-75jq-6523"
- "https://github.com/authlib/authlib/security/advisories/GHSA-fg6f-75jq-6523"
- "https://github.com/authlib/authlib/commit/2808378611dd6fb2532b189a9087877d8f0c0489"
- "https://github.com/authlib/authlib/commit/7974f45e4d7492ab5f527577677f2770ce423228"
- "https://github.com/authlib/authlib"
cvss_v3: "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:H/I:N/A:N"
uuid: "740f3375-9b36-4ef8-9f84-734019afa55e"
cwe_ids:
- "CWE-352"
- "CWE-937"
- "CWE-1035"
