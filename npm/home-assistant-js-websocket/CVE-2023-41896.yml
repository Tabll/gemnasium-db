---
identifier: "CVE-2023-41896"
identifiers:
- "CVE-2023-41896"
- "GHSA-cr83-q7r2-7f5q"
- "GHSA-935v-rmg9-44mw"
package_slug: "npm/home-assistant-js-websocket"
title: "Insufficient Verification of Data Authenticity"
description: "Home assistant is an open source home automation. Whilst auditing the
  frontend code to identify hidden parameters, Cure53 detected `auth_callback=1`,
  which is leveraged by the WebSocket authentication logic in tandem with the `state`
  parameter. The state parameter contains the `hassUrl`, which is subsequently utilized
  to establish a WebSocket connection. This behavior permits an attacker to create
  a malicious Home Assistant link with a modified state parameter that forces the
  frontend to connect to an alternative WebSocket backend. Henceforth, the attacker
  can spoof any WebSocket responses and trigger cross site scripting (XSS). Since
  the XSS is executed on the actual Home Assistant frontend domain, it can connect
  to the real Home Assistant backend, which essentially represents a comprehensive
  takeover scenario. Permitting the site to be iframed by other origins, as discussed
  in GHSA-935v-rmg9-44mw, renders this exploit substantially covert since a malicious
  website can obfuscate the compromise strategy in the background. However, even without
  this, the attacker can still send the `auth_callback` link directly to the victim
  user. To mitigate this issue, Cure53 advises modifying the WebSocket codeâ€™s authentication
  flow. An optimal implementation in this regard would not trust the `hassUrl` passed
  in by a GET parameter. Cure53 must stipulate the significant time required of the
  Cure53 consultants to identify an XSS vector, despite holding full control over
  the WebSocket responses. In many areas, data from the WebSocket was properly sanitized,
  which hinders post-exploitation. The audit team eventually detected the `js_url`
  for custom panels, though generally, the frontend exhibited reasonable security
  hardening. This issue has been addressed in Home Assistant Core version 2023.8.0
  and in the npm package home-assistant-js-websocket in version 8.2.0. Users are advised
  to upgrade. There are no known workarounds for this vulnerability."
date: "2023-10-26"
pubdate: "2023-10-19"
affected_range: "<8.2.0"
fixed_versions:
- "8.2.0"
affected_versions: "All versions before 8.2.0"
not_impacted: "All versions starting from 8.2.0"
solution: "Upgrade to version 8.2.0 or above."
urls:
- "https://nvd.nist.gov/vuln/detail/CVE-2023-41896"
- "https://github.com/home-assistant/core/security/advisories/GHSA-cr83-q7r2-7f5q"
- "https://github.com/home-assistant/core/security/advisories/GHSA-935v-rmg9-44mw"
cvss_v3: "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:H/I:H/A:H"
uuid: "f05c2bc6-9143-4fc7-ba15-d141bca5d763"
cwe_ids:
- "CWE-1035"
- "CWE-345"
- "CWE-937"
