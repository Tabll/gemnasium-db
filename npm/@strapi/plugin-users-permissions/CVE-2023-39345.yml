---
identifier: "CVE-2023-39345"
identifiers:
- "GHSA-gc7p-j5xm-xxh2"
- "CVE-2023-39345"
package_slug: "npm/@strapi/plugin-users-permissions"
title: "Unauthorized Access to Private Fields in User Registration API"
description: "### System Details\n| Name   | Value         |\n|----------|------------------------|\n|
  OS    | Windows 11       |\n| Version | 4.11.1 (node v16.14.2) |\n| Database | mysql
  \        |\n\n\n### Description\nI marked some fields as private fields in user
  content-type, and tried to register as a new user via api, at the same time I added
  content to fill the private fields and sent a post request, and as you can see from
  the images below, I can write to the private fields.\n\n
  To prevent this, I went to the extension area and tried to extend the register method,
  for this I wanted to do it using the sanitizeInput function that I know in the source
  codes of the strap. But the sanitizeInput function does not filter out private fields.\n\n```js\n
  const { auth } = ctx.state;\n const data = ctx.request.body;\n const userSchema
  = strapi.getModel(\"plugin::users-permissions.user\");\n\n sanitize.contentAPI.input(data,
  userSchema, { auth });\n```\n\nhere's the solution I've temporarily kept to myself,
  code snippet\n\n```js\n const body = ctx.request.body;\n\n const { attributes }
  = strapi.getModel(\"plugin::users-permissions.user\");\n\n const sanitizedData =
  _.omitBy(body, (data, key) => {\n  const attribute = attributes[key];\n\n  if (_.isNil(attribute))
  {\n   return false;\n  }\n\n  //? If you want, you can throw an error for fields
  that we does not expect.\n\n  // if (_.isNil(attribute))\n  //  throw new ApplicationError(`Unexpected
  value ${key}`);\n\n  // if private value is true, we do not want to send it to the
  database.\n  return attribute.private;\n });\n\n return sanitizedData;\n```\n\n"
date: "2023-11-03"
pubdate: "2023-11-03"
affected_range: ">=4.0.0 <4.13.1"
fixed_versions:
- "4.13.1"
affected_versions: "All versions starting from 4.0.0 before 4.13.1"
not_impacted: "All versions before 4.0.0, all versions starting from 4.13.1"
solution: "Upgrade to version 4.13.1 or above."
urls:
- "https://github.com/strapi/strapi/security/advisories/GHSA-gc7p-j5xm-xxh2"
- "https://strapi.io/blog/security-disclosure-of-vulnerabilities-sept-2023"
- "https://github.com/advisories/GHSA-gc7p-j5xm-xxh2"
uuid: "7d04d0f7-01d7-440a-9799-ef325895b293"
cwe_ids:
- "CWE-1035"
- "CWE-937"
...
