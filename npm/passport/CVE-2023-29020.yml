---
identifier: "CVE-2023-29020"
identifiers:
- "CVE-2023-29020"
- "GHSA-2ccf-ffrj-m4qw"
package_slug: "npm/passport"
title: "Cross-Site Request Forgery (CSRF)"
description: "@fastify/passport is a port of passport authentication library for the
  Fastify ecosystem. The CSRF (Cross-Site Request Forger) protection enforced by the
  `@fastify/csrf-protection` library, when combined with `@fastify/passport` in affected
  versions, can be bypassed by network and same-site attackers. `fastify/csrf-protection`
  implements the synchronizer token pattern (using plugins `@fastify/session` and
  `@fastify/secure-session`) by storing a random value used for CSRF token generation
  in the `_csrf` attribute of a user's session. The `@fastify/passport` library does
  not clear the session object upon authentication, preserving the `_csrf` attribute
  between pre-login and authenticated sessions. Consequently, CSRF tokens generated
  before authentication are still valid. Network and same-site attackers can thus
  obtain a CSRF token for their pre-session, fixate that pre-session in the victim's
  browser via cookie tossing, and then perform a CSRF attack after the victim authenticates.
  As a solution, newer versions of `@fastify/passport` include the configuration options:
  `clearSessionOnLogin (default: true)` and `clearSessionIgnoreFields (default: ['passport',
  'session'])` to clear all the session attributes by default, preserving those explicitly
  defined in `clearSessionIgnoreFields`."
date: "2023-05-03"
pubdate: "2023-04-21"
affected_range: "<1.1.0||>=2.0.0 <2.3.0"
fixed_versions:
- "1.1.0"
- "2.3.0"
affected_versions: "All versions before 1.1.0, all versions starting from 2.0.0 before
  2.3.0"
not_impacted: "All versions starting from 1.1.0 before 2.0.0, all versions starting from
  2.3.0"
solution: "Upgrade to version 1.1.1, 2.3.0 or above."
urls:
- "https://nvd.nist.gov/vuln/detail/CVE-2023-29020"
- "https://github.com/fastify/fastify-passport/security/advisories/GHSA-2ccf-ffrj-m4qw"
- "https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html#synchronizer-token-pattern"
- "https://github.com/fastify/fastify-passport/commit/07c90feab9cba0dd4779e47cfb0717a7e2f01d3d"
- "https://owasp.org/www-community/attacks/csrf"
cvss_v3: "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:H/A:N"
uuid: "ec35bbc3-d8c7-4c40-b534-01b6c4097d7a"
cwe_ids:
- "CWE-1035"
- "CWE-352"
- "CWE-937"
