---
identifier: "CVE-2022-23628"
identifiers:
- "GHSA-hcw3-j74m-qc58"
- "CVE-2022-23628"
package_slug: "go/github.com/open-policy-agent/opa"
title: "Incorrect Calculation"
description: "OPA is an open source, general-purpose policy engine. Under certain
  conditions, pretty-printing an abstract syntax tree (AST) that contains synthetic
  nodes could change the logic of some statements by reordering array literals. Example
  of policies impacted are those that parse and compare web paths. **All of these**
  three conditions have to be met to create an adverse effect: An AST of Rego had
  to be **created programmatically** such that it ends up containing terms without
  a location (such as wildcard variables). The AST had to be **pretty-printed** using
  the `github.com/open-policy-agent/opa/format` package. The result of the pretty-printing
  had to be **parsed and evaluated again** via an OPA instance using the bundles,
  or the Golang packages. If any of these three conditions are not met, you are not
  affected. Notably, all three would be true if using **optimized bundles**, i.e.
  bundles created with `opa build -O=1` or higher. In that case, the optimizer would
  fulfil condition (1.), the result of that would be pretty-printed when writing the
  bundle to disk, fulfilling (2.). When the bundle was then used, we'd satisfy (3.).
  As a workaround users may disable optimization when creating bundles."
date: "2022-02-11"
pubdate: "2022-02-09"
affected_range: ">=0.33.1 <0.37.0"
fixed_versions:
- "0.37.0"
affected_versions: "All versions starting from 0.33.1 before 0.37.0"
not_impacted: "All versions before 0.33.1, all versions starting from 0.37.0"
solution: "Upgrade to version 0.37.0 or above."
urls:
- "https://github.com/open-policy-agent/opa/security/advisories/GHSA-hcw3-j74m-qc58"
- "https://github.com/open-policy-agent/opa/pull/3851"
- "https://github.com/open-policy-agent/opa/commit/932e4ffc37a590ace79e9b75ca4340288c220239"
- "https://github.com/open-policy-agent/opa/commit/bfd984ddf93ef2c4963a08d4fdadae0bcf1a3717"
- "https://nvd.nist.gov/vuln/detail/CVE-2022-23628"
- "https://github.com/advisories/GHSA-hcw3-j74m-qc58"
uuid: "a7d7daf9-8c26-4045-8f73-71df0ddd5c69"
cwe_ids:
- "CWE-1035"
- "CWE-682"
- "CWE-937"
cvss_v2: "AV:N/AC:M/Au:N/C:N/I:P/A:N"
cvss_v3: "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:N"
