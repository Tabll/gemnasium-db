---
identifier: "CVE-2023-32186"
identifiers:
- "GHSA-p45j-vfv5-wprq"
- "CVE-2023-32186"
package_slug: "go/github.com/rancher/rke2"
title: "RKE2 supervisor port is vulnerable to unauthenticated remote denial-of-service
  (DoS) attack via TLS SAN stuffing attack"
description: "### Impact\n\nAn issue was found in RKE2 where an attacker with network
  access to RKE2 servers' supervisor port (TCP 9345) can force the TLS server to add
  entries to the certificate's Subject Alternative Name (SAN) list, through a stuffing
  attack, until the certificate grows so large that it exceeds the maximum size allowed
  by TLS client implementations. OpenSSL for example will raise an `excessive message
  size` error when this occurs. No authentication is necessary to perform this attack,
  only the ability to perform a TLS handshake against the supervisor port (TCP 9345).\n\nAffected
  servers will continue to operate, but clients (server or agent nodes) will fail
  to establish new connections when joining or rejoining the cluster, thus leading
  to a denial of service (DoS) attack.\n\n### Remediation\n\nUpgrade to a fixed release:\n-
  v1.28.1\n- v1.27.5\n- v1.26.8\n- v1.25.13\n- 1.24.17\n\nIf you are using RKE2 1.27
  or earlier, you must also add the parameter `tls-san-security: true` to the RKE2
  configuration to enable enhanced security for the supervisor's TLS SAN list. This
  option defaults to `true` starting with RKE2 1.28.\n\nNote that this flag changes
  the behavior of RKE2's supervisor listener. You should ensure that you configure
  `node-external-ip` on servers that will be connected to via an external IP, and
  add `tls-san` entries for any load-balancers or VIP addresses that will be associated
  with the supervisor port. External IPs and load-balancer/VIP addresses will no longer
  be added to the supervisor certificate's SAN list unless explicitly configured.\n\n###
  Mitigation\n\nIf you cannot upgrade to a fixed release, the certificate can be \"frozen\"
  by running the following command against the cluster:\n\n```shell\nkubectl annotate
  secret -n kube-system rke2-serving listener.cattle.io/static=true\n```\n\n**⚠️ IMPORTANT
  CAUTION:** Note that this mitigation will prevent the certificate from adding new
  SAN entries when servers join the cluster, and automatically renewing itself when
  it is about to expire. If you do this, you should delete the annotation when adding
  new servers to the cluster, or when the certificate is within 90 days of expiring,
  so that it can be updated. Once that is done, you can freeze it again.\n\nAffected
  certificates can be reset by performing the following steps:\n* Run `kubectl delete
  secret -n kube-system rke2-serving`\n* Delete `/var/lib/rancher/rke2/server/tls/dynamic-cert.json`
  from all servers, and restart the `rke2-server` service.\n\n### Background\n\nThe
  RKE2 supervisor listens on port TCP 9345 and uses the `rancher/dynamiclistener`
  library to dynamically generate TLS certificates that contain TLS Subject Alternative
  Names (SAN) for any host name or IP address requested by a client. This is done
  to allow servers and external load-balancers to be added to the cluster without
  the administrator having to explicitly know and configure in advance a fixed list
  of endpoints that the supervisor may be hosted at.\n\nThe library allows the embedding
  application to configure a callback that is used to filter addresses requested by
  clients; but this was not previously implemented in RKE2.\n\n### For more information\n\nIf
  you have any questions or comments about this advisory:\n\n- Reach out to the [SUSE
  Rancher Security team](https://github.com/rancher/rke2/security/policy) for security
  related inquiries.\n- Open an issue in the [RKE2](https://github.com/rancher/rke2/issues/new/choose)
  repository.\n- Verify with our [support matrix](https://www.suse.com/suse-rancher/support-matrix/all-supported-versions/)
  and [product support lifecycle](https://www.suse.com/lifecycle/)."
date: "2023-09-11"
pubdate: "2023-09-11"
affected_range: "<v1.24.17 || >=v1.25.0 <v1.25.13 || >=v1.26.0 <v1.26.8 || >=v1.27.0
  <v1.27.5 || >=v1.28.0 <v1.28.1"
fixed_versions:
- "v1.24.17"
- "v1.25.13"
- "v1.26.8"
- "v1.27.5"
- "v1.28.1"
affected_versions: "All versions before 1.24.17, all versions starting from 1.25.0
  before 1.25.13, all versions starting from 1.26.0 before 1.26.8, all versions starting
  from 1.27.0 before 1.27.5, all versions starting from 1.28.0 before 1.28.1"
not_impacted: "All versions starting from 1.24.17 before 1.25.0, all versions starting
  from 1.25.13 before 1.26.0, all versions starting from 1.26.8 before 1.27.0, all
  versions starting from 1.27.5 before 1.28.0, all versions starting from 1.28.1"
solution: "Upgrade to versions 1.24.17, 1.25.13, 1.26.8, 1.27.5, 1.28.1 or above."
urls:
- "https://github.com/rancher/rke2/security/advisories/GHSA-p45j-vfv5-wprq"
- "https://github.com/advisories/GHSA-p45j-vfv5-wprq"
uuid: "ac972950-1349-4ade-973a-90c19dd53f94"
cwe_ids:
- "CWE-1035"
- "CWE-937"
versions:
- number: "v1.25.0"
  commit:
    tags:
    - "v1.25.0"
    sha: "68e5e0cccf170c61bda3c4a5356d3b59f490ab61"
    timestamp: "20220901175750"
- number: "v1.26.0"
  commit:
    tags:
    - "v1.26.0"
    sha: "f7c905fd863ff34a05e01fc5c0d49029f22da7d4"
    timestamp: "20221212215844"
- number: "v1.27.5"
  commit:
    tags:
    - "v1.27.5"
    sha: "d3f409d4b5d7519a92dba046e47c61d0ed81b49a"
    timestamp: "20230825171540"
- number: "v1.26.8"
  commit:
    tags:
    - "v1.26.8"
    sha: "a99c88f10912114bdf5aede32fc647820f0560a0"
    timestamp: "20230825171557"
- number: "v1.25.13"
  commit:
    tags:
    - "v1.25.13"
    sha: "f4a6a1a34632dc986b5770e2b2d9ebc06b015578"
    timestamp: "20230825171609"
- number: "v1.24.17"
  commit:
    tags:
    - "v1.24.17"
    sha: "eb44960ba3dc7b36b623e81bdcb466e2ea528357"
    timestamp: "20230825212722"
- number: "v1.28.1"
  commit:
    tags:
    - "v1.28.1"
    sha: "642f36124419788f1b190b50bbf9c58742a5129f"
    timestamp: "20230829225135"
cvss_v3: "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H"
