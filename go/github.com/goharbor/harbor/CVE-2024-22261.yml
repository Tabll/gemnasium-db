---
identifier: "CVE-2024-22261"
identifiers:
- "CVE-2024-22261"
- "GHSA-vw63-824v-qf2j"
package_slug: "go/github.com/goharbor/harbor"
title: "SQL Injection in Harbor scan log API"
description: "A user with an administrator, project_admin, or project_maintainer role
  could utilize and exploit SQL Injection to allow the execution of any Postgres function
  or the extraction of sensitive information from the database through this API:\n```\nGET
  /api/v2.0/projects/{project_name}/repositories/{repository_name}/artifacts/{reference}/scan/{report_id}/log\n```\nThe
  SQL injection might happen in the code:\n\nhttps://github.com/goharbor/harbor/blob/9b7c1a2274fbc5ea16e19a484532f86c08926577/src/pkg/task/task.go#L241\n\nBecause
  raw SQL executed in ormer.Raw(Sql).QueryRows() is PrepareStatement. In the driver
  of Postgres, one PrepareStatement must contain only ONE SQL command, see https://www.postgresql.org/docs/15/libpq-exec.html#LIBPQ-PQPREPARE.
  \ The SQL should start with:\n```\nSELECT * FROM task WHERE extra_attrs::jsonb->'report_uuids'
  @>\n```\nAdding a delete/update operation by appending malicious content to the
  current SQL is impossible. Furthermore, the query result of the task is just an
  intermediate result, the task ID is used to locate the job log file, and the response
  only contains the content of the job log file. so this vulnerability can be used
  to execute SQL functions, but it can't leak any useful information to the response.\n\nHarbor
  >=v2.8.1, >=2.9.0, >=2.10.0 are impacted."
date: "2024-06-02"
pubdate: "2024-06-02"
affected_range: "<2.8.6||>=2.9.0 <2.9.4||>=2.10.0 <2.10.2"
fixed_versions:
- "2.8.6"
- "2.9.4"
- "2.10.2"
affected_versions: "All versions before 2.8.6, all versions starting from 2.9.0 before
  2.9.4, all versions starting from 2.10.0 before 2.10.2"
not_impacted: "All versions starting from 2.8.6 before 2.9.0, all versions starting
  from 2.9.4 before 2.10.0, all versions starting from 2.10.2"
solution: "Upgrade to versions 2.10.2, 2.8.6, 2.9.4 or above."
urls:
- "https://nvd.nist.gov/vuln/detail/CVE-2024-22261"
- "https://github.com/advisories/GHSA-vw63-824v-qf2j"
- "https://github.com/goharbor/harbor/security/advisories/GHSA-vw63-824v-qf2j"
- "https://github.com/goharbor/harbor"
uuid: "3c73dcc5-4879-4f4c-9430-6438ebdf459a"
cwe_ids:
- "CWE-937"
- "CWE-1035"
