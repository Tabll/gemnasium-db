---
identifier: "CVE-2023-32187"
identifiers:
- "GHSA-m4hf-6vgr-75r2"
- "CVE-2023-32187"
package_slug: "go/github.com/k3s-io/k3s"
title: "K3s apiserver port is vulnerable to unauthenticated remote denial-of-service
  (DoS) attack via TLS SAN stuffing attack"
description: "### Impact\n\nAn issue was found in K3s where an attacker with network
  access to K3s servers' apiserver/supervisor port (TCP 6443) can force the TLS server
  to add entries to the certificate's Subject Alternative Name (SAN) list, through
  a stuffing attack, until the certificate grows so large that it exceeds the maximum
  size allowed by TLS client implementations. OpenSSL for example will raise an `excessive
  message size` error when this occurs. No authentication is necessary to perform
  this attack, only the ability to perform a TLS handshake against the apiserver/supervisor
  port (TCP 6443).\n\nAffected servers will continue to operate, but clients (including
  both external administrative access with `kubectl` and server or agent nodes) will
  fail to establish new connections, thus leading to a denial of service (DoS) attack.\n\n###
  Remediation\n\nUpgrade to a fixed release:\n\n- v1.28.1+k3s1\n- v1.27.5+k3s1\n-
  v1.26.8+k3s1\n- v1.25.13+k3s1\n- v1.24.17+k3s1\n\nIf you are using K3s 1.27 or earlier,
  you must also add the parameter `tls-san-security: true` to the K3s configuration
  to enable enhanced security for the supervisor's TLS SAN list. This option defaults
  to `true` starting with K3s 1.28.\n\nNote that this flag changes the behavior of
  K3s servers. You should ensure that you configure `node-external-ip` on servers
  that will be connected to via an external IP, and add `tls-san` entries for any
  load-balancers or VIP addresses that will be associated with the supervisor port.
  External IPs and load-balancer/VIP addresses will no longer be added to the supervisor
  certificate's SAN list unless explicitly configured.\n\n### Mitigation\n\nIf you
  cannot upgrade to a fixed release, the certificate can be \"frozen\" by running
  the following command against the cluster:\n\n```shell\nkubectl annotate secret
  -n kube-system k3s-serving listener.cattle.io/static=true\n```\n\n**⚠️ IMPORTANT
  CAUTION:** Note that this mitigation will prevent the certificate from adding new
  SAN entries when servers join the cluster, and automatically renewing itself when
  it is about to expire. If you do this, you should delete the annotation when adding
  new servers to the cluster, or when the certificate is within 90 days of expiring,
  so that it can be updated. Once that is done, you can freeze it again.\n\nAffected
  certificates can be reset by performing the following steps:\n1. Run `kubectl --server
  https://localhost:6444 delete secret -n kube-system k3s-serving`\n2. Delete `/var/lib/rancher/k3s/server/tls/dynamic-cert.json`
  from all servers, and restart the `k3s` service.\n\n### Background\n\nThe K3s apiserver/supervisor
  listener on port TCP 6443 and uses the `rancher/dynamiclistener` library to dynamically
  generate TLS certificates that contain TLS Subject Alternative Names (SAN) for any
  host name or IP address requested by a client. This is done to allow servers and
  external load-balancers to be added to the cluster without the administrator having
  to explicitly know and configure in advance a fixed list of endpoints that the supervisor
  may be hosted at.\n\nThe library allows the embedding application to configure a
  callback that is used to filter addresses requested by clients; but this was not
  previously implemented in K3s.\n\n### For more information\n\nIf you have any questions
  or comments about this advisory:\n\n- Reach out to the [K3s Security team](https://github.com/k3s-io/k3s/security/policy)
  for security related inquiries.\n- Open an issue in the [K3s](https://github.com/k3s-io/k3s/issues/new/choose)
  repository.\n- Verify with our [support matrix](https://www.suse.com/suse-k3s/support-matrix/all-supported-versions)
  and [product support lifecycle](https://www.suse.com/lifecycle/#k3s)."
date: "2023-09-11"
pubdate: "2023-09-11"
affected_range: "<1.24.17||>=1.25.0 <1.25.13||>=1.26.0 <1.26.8||>=1.27.0 <1.27.5||>=1.28.0
  <1.28.1"
fixed_versions:
- "1.24.17"
- "1.25.13"
- "1.26.8"
- "1.27.5"
- "1.28.1"
affected_versions: "All versions before 1.24.17, all versions starting from 1.25.0
  before 1.25.13, all versions starting from 1.26.0 before 1.26.8, all versions starting
  from 1.27.0 before 1.27.5, all versions starting from 1.28.0 before 1.28.1"
not_impacted: "All versions starting from 1.24.17 before 1.25.0, all versions starting
  from 1.25.13 before 1.26.0, all versions starting from 1.26.8 before 1.27.0, all
  versions starting from 1.27.5 before 1.28.0, all versions starting from 1.28.1"
solution: "Upgrade to versions 1.24.17, 1.25.13, 1.26.8, 1.27.5, 1.28.1 or above."
urls:
- "https://github.com/k3s-io/k3s/security/advisories/GHSA-m4hf-6vgr-75r2"
- "https://github.com/advisories/GHSA-m4hf-6vgr-75r2"
uuid: "cb9c46e4-dc53-4ca7-bdcb-48a8a2b0c2ff"
cwe_ids:
- "CWE-1035"
- "CWE-937"
cvss_v3: "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H"
