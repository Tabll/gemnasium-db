---
identifier: "CVE-2025-65955"
identifiers:
- "CVE-2025-65955"
- "GHSA-q3hc-j9x5-mp9m"
package_slug: "nuget/magick.net-q16-x64"
title: "ImageMagick has a use-after-free/double-free risk in Options::fontFamily when
  clearing family"
description: "We believe that we have discovered a potential security vulnerability
  in ImageMagick’s Magick++ layer that manifests when `Options::fontFamily` is invoked
  with an empty string.\n\n**Vulnerability Details**\n- Clearing a font family calls
  `RelinquishMagickMemory` on `_drawInfo->font`, freeing the font string but leaving
  `_drawInfo->font` pointing to freed memory while `_drawInfo->family` is set to that
  (now-invalid) pointer. Any later cleanup or reuse of `_drawInfo->font` re-frees
  or dereferences dangling memory.\n- `DestroyDrawInfo` and other setters (`Options::font`,
  `Image::font`) assume `_drawInfo->font` remains valid, so destruction or subsequent
  updates trigger crashes or heap corruption.\n\n```cpp\nif (family_.length() == 0)\n{\n_drawInfo->family=(char
  *) RelinquishMagickMemory(_drawInfo->font);\nDestroyString(RemoveImageOption(imageInfo(),\"family\"));\n}\n```\n\n-
  **CWE-416 (Use After Free):** `_drawInfo->font` is left dangling yet still reachable
  through the Options object.\n- **CWE-415 (Double Free):** DrawInfo teardown frees
  `_drawInfo->font` again, provoking allocator aborts.\n\n**Affected Versions**\n-
  Introduced by commit `6409f34d637a34a1c643632aa849371ec8b3b5a8` (“Added fontFamily
  to the Image class of Magick++”, 2015-08-01, blame line 313).\n- Present in all
  releases that include that commit, at least ImageMagick 7.0.1-0 and later (likely
  late 6.9 builds with Magick++ font family support as well). Older releases without
  `fontFamily` are unaffected.\n\n**Command Line Triggerability**\nThis vulnerability
  cannot be triggered from the command line interface. The bug is specific to the
  Magick++ C++ API, specifically the `Options::fontFamily()` method. The command-line
  utilities (such as `convert`, `magick`, etc.) do not expose this particular code
  path, as they operate through different internal mechanisms that do not directly
  call `Options::fontFamily()` with an empty string in a way that would trigger the
  use-after-free condition.\n\n**Proposed Fix**\n```diff\ndiff --git a/Magick++/lib/Options.cpp
  b/Magick++/lib/Options.cpp\n@@ void Magick::Options::fontFamily(const std::string
  &family_)\n-      _drawInfo->family=(char *) RelinquishMagickMemory(_drawInfo->font);\n+
  \     _drawInfo->family=(char *) RelinquishMagickMemory(_drawInfo->family);\n```\nThis
  frees only the actual family string, leaving `_drawInfo->font` untouched. Optionally
  nulling `_drawInfo->font` when clearing `font()` itself maintains allocator hygiene."
date: "2025-12-03"
pubdate: "2025-12-03"
affected_range: "[,14.9.1]"
fixed_versions: []
affected_versions: "All versions up to 14.9.1"
not_impacted: ""
solution: "Unfortunately, there is no solution available yet."
urls:
- "https://nvd.nist.gov/vuln/detail/CVE-2025-65955"
- "https://github.com/advisories/GHSA-q3hc-j9x5-mp9m"
- "https://github.com/ImageMagick/ImageMagick/security/advisories/GHSA-q3hc-j9x5-mp9m"
- "https://github.com/ImageMagick/ImageMagick/commit/6409f34d637a34a1c643632aa849371ec8b3b5a8"
- "https://github.com/ImageMagick/ImageMagick/commit/6f81eb15f822ad86e8255be75efad6f9762c32f8"
- "https://github.com/ImageMagick/ImageMagick"
cvss_v3: "CVSS:3.1/AV:L/AC:H/PR:N/UI:N/S:U/C:L/I:L/A:L"
uuid: "1ac2713a-41f1-4891-a4cd-e51338137ed7"
cwe_ids:
- "CWE-415"
- "CWE-937"
- "CWE-1035"
