---
identifier: "CVE-2023-45814"
identifiers:
- "GHSA-jrf2-h5j6-3rrq"
- "CVE-2023-45814"
package_slug: "nuget/Bunkum"
title: "Bunkum tokens cached in the AuthenticationService are susceptible to a use-after-free"
description: "Bunkum is an open-source protocol-agnostic request server for custom
  game servers. First, a little bit of background. So, in the beginning, Bunkum's
  `AuthenticationService` only supported injecting `IUser`s. However, as Refresh and
  SoundShapesServer implemented permissions systems support for injecting `IToken`s
  into endpoints was added. All was well until 4.0. Bunkum 4.0 then changed to enforce
  relations between `IToken`s and `IUser`s. This wasn't implemented in a very good
  way in the `AuthenticationService`, and ended up breaking caching in such a way
  that cached tokens would persist after the lifetime of the request - since we tried
  to cache both tokens and users. From that point until now, from what I understand,
  Bunkum was attempting to use that cached token at the start of the next request
  once cached. Naturally, when that token expired, downstream projects like Refresh
  would remove the object from Realm - and cause the object in the cache to be in
  a detached state, causing an exception from invalid use of `IToken.User`. So in
  other words, a use-after-free since Realm can't manage the lifetime of the cached
  token. Security-wise, the scope is fairly limited, can only be pulled off on a couple
  endpoints given a few conditions, and you can't guarantee which token you're going
  to get. Also, the token *would* get invalidated properly if the endpoint had either
  a `IToken` usage or a `IUser` usage. The fix is to just wipe the token cache after
  the request was handled, which is now in `4.2.1`. Users are advised to upgrade.
  There are no known workarounds for this vulnerability."
date: "2023-10-19"
pubdate: "2023-10-19"
affected_range: "[4.0.0,4.2.1)"
fixed_versions:
- "4.2.1"
affected_versions: "All versions starting from 4.0.0 before 4.2.1"
not_impacted: "All versions before 4.0.0, all versions starting from 4.2.1"
solution: "Upgrade to version 4.2.1 or above."
urls:
- "https://github.com/LittleBigRefresh/Bunkum/security/advisories/GHSA-jrf2-h5j6-3rrq"
- "https://nvd.nist.gov/vuln/detail/CVE-2023-45814"
- "https://github.com/LittleBigRefresh/Bunkum/commit/6e109464ed9255f558182f001f475a378405ff76"
- "https://github.com/advisories/GHSA-jrf2-h5j6-3rrq"
uuid: "7d7ec3fc-e9be-4f7f-801f-7181ed9d7dc0"
cwe_ids:
- "CWE-1035"
- "CWE-937"
cvss_v3: "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N"
