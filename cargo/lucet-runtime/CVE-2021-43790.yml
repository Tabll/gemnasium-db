---
identifier: "CVE-2021-43790"
identifiers:
- "CVE-2021-43790"
- "GHSA-hf79-8hjp-rrvq"
package_slug: "cargo/lucet-runtime"
title: "Use After Free in lucet"
description: "Lucet uses a \"pool\" allocator for new WebAssembly instances that are
  created. This pool allocator manages everything from the linear memory of the wasm
  instance, the runtime stack for async switching, as well as the memory behind the
  Instance itself. `Instances` are referred to via an `InstanceHandle` type which
  will, on drop, release the memory backing the Instance back to the pool.\n\nWhen
  an Instance is dropped, the fields of the `Instance` are destructed top-to-bottom,
  however when the `alloc: Alloc` field is destructed, the memory backing the `Instance`
  is released back to the pool before the destructors of the remaining fields are
  run. If another thread allocates the same memory from the pool while these destructors
  are still running, a race condition occurs that can lead to use-after-free errors.\n\nThe
  bug was corrected by changing how the `InstanceHandle` destructor operates to ensure
  that the memory backing an Instance is only returned to the pool once the `Instance`
  has been completely destroyed.\n\nThis security advisory has been assigned CVE-2021-43790."
date: "2021-11-30"
pubdate: "2021-11-30"
affected_range: "<=0.6.1"
fixed_versions: []
affected_versions: "All versions up to 0.6.1"
not_impacted: ""
solution: "Unfortunately, there is no solution available yet."
urls:
- "https://nvd.nist.gov/vuln/detail/CVE-2021-43790"
- "https://github.com/advisories/GHSA-hf79-8hjp-rrvq"
- "https://github.com/bytecodealliance/lucet/security/advisories/GHSA-hf79-8hjp-rrvq"
- "https://github.com/bytecodealliance/lucet/commit/7c7757c772fb709c61b1442bcc1e1fbee97bf4a8"
- "https://crates.io/crates/lucet-runtime"
- "https://github.com/bytecodealliance/lucet"
cvss_v3: "CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:C/C:H/I:H/A:H"
uuid: "e1d19d16-ad8a-4665-823b-751c74c155d5"
cwe_ids:
- "CWE-416"
- "CWE-937"
- "CWE-1035"
