---
identifier: "CVE-2021-45695"
identifiers:
- "CVE-2021-45695"
- "GHSA-2gxj-qrp2-53jv"
package_slug: "cargo/mopa"
title: "Incorrect reliance on Trait memory layout in mopa"
description: "The mopa crate redefines the deprecated TraitObject struct from core::raw.
  This is done to then transmute a reference to a trait object (&dyn Trait for any
  trait Trait) into this struct and retrieve the data field for the purpose of downcasting.
  This is used to implement downcast_ref_unchecked(), in terms of which downcast_ref()
  is also implemented. Same goes for mutable reference downcasting and Box downcasting.\n\nThe
  Rust compiler explicitly reserves the right to change the memory layout of &dyn
  Trait for any trait Trait. The worst case scenario is that it swaps data and vtable,
  making an executable location breach and compromisation of ASLR possible, since
  reads from data would read vtable instead. Likewise, arbitrary code execution is
  also theoretically possible if reads of vtable generated by the compiler read data
  instead."
date: "2023-06-13"
pubdate: "2022-01-06"
affected_range: "<=0.2.2"
fixed_versions: []
affected_versions: "All versions up to 0.2.2"
not_impacted: ""
solution: "Unfortunately, there is no solution available yet."
urls:
- "https://nvd.nist.gov/vuln/detail/CVE-2021-45695"
- "https://github.com/advisories/GHSA-2gxj-qrp2-53jv"
- "https://github.com/chris-morgan/mopa/issues/13"
- "https://github.com/chris-morgan/mopa"
- "https://raw.githubusercontent.com/rustsec/advisory-db/main/crates/mopa/RUSTSEC-2021-0095.md"
- "https://rustsec.org/advisories/RUSTSEC-2021-0095.html"
cvss_v3: "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H"
uuid: "c0f6ded3-8448-43a1-aa92-1417633e6ac8"
cwe_ids:
- "CWE-937"
- "CWE-1035"
