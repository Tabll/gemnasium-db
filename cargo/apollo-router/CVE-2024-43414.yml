---
identifier: "CVE-2024-43414"
identifiers:
- "CVE-2024-43414"
- "GHSA-fmj9-77q8-g6c4"
package_slug: "cargo/apollo-router"
title: "Apollo Query Planner and Apollo Gateway may infinitely loop on sufficiently
  complex queries"
description: "Instances of @apollo/query-planner >=2.0.0 and <2.8.5 are impacted by
  a denial-of-service vulnerability. @apollo/gateway versions >=2.0.0 and < 2.8.5
  and Apollo Router <1.52.1 are also impacted through their use of @apollo/query-planner.\n\nIf
  @apollo/query-planner is asked to plan a sufficiently complex query, it may loop
  infinitely and never complete. This results in unbounded memory consumption and
  either a crash or out-of-memory (OOM) termination.\n\nThis issue can be triggered
  if you have at least one non-`@key` field that can be resolved by multiple subgraphs.
  To identify these shared fields, the schema for each subgraph must be reviewed.
  The mechanism to identify shared fields varies based on the version of Federation
  your subgraphs are using.\n\nYou can check if your subgraphs are using Federation
  1 or Federation 2 by reviewing their schemas. Federation 2 subgraph schemas will
  contain a `@link` directive referencing the version of Federation being used while
  Federation 1 subgraphs will not. For example, in a Federation 2 subgraph, you will
  find a line like `@link(url: \"https://specs.apollo.dev/federation/v2.0\")`. If
  a similar `@link` directive is not present in your subgraph schema, it is using
  Federation 1. Note that a supergraph can contain a mix of Federation 1 and Federation
  2 subgraphs.\n\n**To review Federation 1 subgraphs for impact:**\n\nIn Federation
  1 subgraphs, fields are implicitly shareable across subgraphs. To review for impact,
  you will need to review for cases where multiple subgraphs can resolve the same
  field. For example:\n\n```graphql"
date: "2024-09-13"
pubdate: "2024-08-27"
affected_range: "<1.52.1"
fixed_versions:
- "1.52.1"
affected_versions: "All versions before 1.52.1"
not_impacted: "All versions starting from 1.52.1"
solution: "Upgrade to version 1.52.1 or above."
urls:
- "https://nvd.nist.gov/vuln/detail/CVE-2024-43414"
- "https://github.com/advisories/GHSA-fmj9-77q8-g6c4"
- "https://github.com/apollographql/federation/security/advisories/GHSA-fmj9-77q8-g6c4"
- "https://github.com/apollographql/router/commit/e309c9bb5a48c1304ff69c88b7eabdd08c26bf45"
- "https://github.com/apollographql/federation"
- "https://www.apollographql.com/docs/federation/query-plans"
- "https://www.apollographql.com/docs/router/configuration/persisted-queries"
cvss_v3: "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H"
uuid: "ef5e6d39-bfe7-43ae-9a80-a862054b6315"
cwe_ids:
- "CWE-673"
- "CWE-674"
- "CWE-937"
- "CWE-1035"
