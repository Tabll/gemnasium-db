---
identifier: "CVE-2024-41949"
identifiers:
- "CVE-2024-41949"
- "GHSA-p9w4-585h-g3c7"
package_slug: "cargo/biscuit-auth"
title: "biscuit-auth vulnerable to public key confusion in third party block"
description: "Third-party blocks can be generated without transferring the whole token
  to the third-party authority. Instead, a `ThirdPartyBlock` request can be sent,
  providing only the necessary info to generate a third-party block and to sign it:\n\n-
  the public key of the previous block (used in the signature)\n- the public keys
  part of the token symbol table (for public key interning in datalog expressions)\n\nA
  third-part block request forged by a malicious user can trick the third-party authority
  into generating datalog trusting the wrong keypair.\n\nConsider the following example
  (nominal case)\n\n- Authority `A` emits the following token: `check if thirdparty(\"b\")
  trusting ${pubkeyB}`\n- The well-behaving holder then generates a third-party block
  request based on the token and sends it to third-party authority `B`\n- Third-party
  `B` generates the following third-party block `thirdparty(\"b\"); check if thirdparty(\"c\")
  trusting ${pubkeyC}`\n- The token holder now must obtain a third-party block from
  third party `C` to be able to use the token\n\nNow, with a malicious user:\n- Authority
  `A` emits the following token: `check if thirdparty(\"b\") trusting ${pubkeyB}`\n-
  The holder then attenuates the token with the following third party block `thirdparty(\"c\")`,
  signed with a keypair `pubkeyD, privkeyD)` they generate\n- The holder then generates
  a third-party block request based on this token, but alter the `ThirdPartyBlockRequest`
  `publicKeys` field and replace `pubkeyD` with `pubkeyC`\n- Third-party `B` generates
  the following third-party block `thirdparty(\"b\"); check if thirdparty(\"c\") trusting
  ${pubkeyC}`\n- Due to the altered symbol table, the actual meaning of the block
  is `thirdparty(\"b\"); check if thirdparty(\"c\") trusting ${pubkeyD}`\n- The attacker
  can now use the token without obtaining a third-party block from `C`."
date: "2024-07-31"
pubdate: "2024-07-31"
affected_range: ">=4.0.0 <5.0.0"
fixed_versions:
- "5.0.0"
affected_versions: "All versions starting from 4.0.0 before 5.0.0"
not_impacted: "All versions before 4.0.0, all versions starting from 5.0.0"
solution: "Upgrade to version 5.0.0 or above."
urls:
- "https://nvd.nist.gov/vuln/detail/CVE-2024-41949"
- "https://github.com/advisories/GHSA-p9w4-585h-g3c7"
- "https://github.com/biscuit-auth/biscuit-rust/security/advisories/GHSA-p9w4-585h-g3c7"
- "https://github.com/biscuit-auth/biscuit-rust"
cvss_v3: "CVSS:3.1/AV:N/AC:H/PR:H/UI:N/S:C/C:N/I:L/A:N"
uuid: "93d2aa90-ed59-4eeb-8987-b09bbbb87343"
cwe_ids:
- "CWE-269"
- "CWE-937"
- "CWE-1035"
