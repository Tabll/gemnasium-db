---
identifier: "CVE-2022-31104"
identifiers:
- "CVE-2022-31104"
- "GHSA-jqwc-c49r-4w2x"
package_slug: "cargo/wasmtime"
title: "Miscompilation of `i8x16.swizzle` and `select` with v128 inputs"
description: "Wasmtime's implementation of the [SIMD proposal for WebAssembly](https://github.com/webassembly/simd)
  on x86_64 contained two distinct bugs in the instruction lowerings implemented in
  Cranelift. The aarch64 implementation of the simd proposal is not affected. The
  bugs were presented in the `i8x16.swizzle` and `select` WebAssembly instructions.
  The `select` instruction is only affected when the inputs are of `v128` type. The
  correspondingly affected Cranelift instructions were `swizzle` and `select`.\n\nThe
  `swizzle` instruction lowering in Cranelift erroneously overwrote the mask input
  register which could corrupt a constant value, for example. This means that future
  uses of the same constant may see a different value than the constant itself.\n\nThe
  `select` instruction lowering in Cranelift wasn't correctly implemented for vector
  types that are 128-bits wide. When the condition was 0 the wrong instruction was
  used to move the correct input to the output of the instruction meaning that only
  the low 32 bits were moved and the upper 96 bits of the result were left as whatever
  the register previously contained (instead of the input being moved from). The `select`
  instruction worked correctly if the condition was nonzero, however.\n\nThis bug
  in Wasmtime's implementation of these instructions on x86_64 represents an incorrect
  implementation of the specified semantics of these instructions according to the
  [WebAssembly specification](https://webassembly.github.io/spec/). The impact of
  this is benign for hosts running WebAssembly but represents possible vulnerabilities
  within the execution of a guest program. For example a WebAssembly program could
  take unintended branches or materialize incorrect values internally which runs the
  risk of exposing the program itself to other related vulnerabilities which can occur
  from miscompilations."
date: "2025-05-02"
pubdate: "2022-06-29"
affected_range: "<0.38.1"
fixed_versions:
- "0.38.1"
affected_versions: "All versions before 0.38.1"
not_impacted: "All versions starting from 0.38.1"
solution: "Upgrade to version 0.38.1 or above."
urls:
- "https://nvd.nist.gov/vuln/detail/CVE-2022-31104"
- "https://github.com/advisories/GHSA-jqwc-c49r-4w2x"
- "https://github.com/bytecodealliance/wasmtime/security/advisories/GHSA-jqwc-c49r-4w2x"
- "https://github.com/bytecodealliance/wasmtime/pull/4317"
- "https://github.com/bytecodealliance/wasmtime/pull/4318"
- "https://docs.rs/wasmtime/latest/wasmtime/struct.Config.html#method.wasm_simd"
- "https://github.com/bytecodealliance/wasmtime"
- "https://github.com/webassembly/simd"
- "https://rustsec.org/advisories/RUSTSEC-2022-0095.html"
- "https://webassembly.github.io/spec"
cvss_v2: "AV:N/AC:M/Au:N/C:P/I:P/A:P"
cvss_v3: "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:L/I:L/A:L"
uuid: "4449c479-c2e1-4582-8efa-b4cc0981f533"
cwe_ids:
- "CWE-682"
- "CWE-937"
- "CWE-1035"
