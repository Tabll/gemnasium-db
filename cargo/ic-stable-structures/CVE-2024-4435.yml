---
identifier: "CVE-2024-4435"
identifiers:
- "CVE-2024-4435"
- "GHSA-3rcq-39xp-7xjp"
package_slug: "cargo/ic-stable-structures"
title: "ic-stable-structures vulnerable to BTreeMap memory leak when deallocating
  nodes with overflows"
description: "When storing unbounded types in a `BTreeMap`, a node is represented
  as a linked list of \"memory chunks\". It was discovered recently that when we deallocate
  a node, in some cases only the first memory chunk is deallocated, and the rest of
  the memory chunks remain (incorrectly) allocated, causing a memory leak.\n\nIn the
  worst case, depending on how a canister uses the `BTreeMap`, an adversary could
  interact with the canister through its API and trigger interactions with the map
  that keep consuming memory due to the memory leak. This could potentially lead to
  using an excessive amount of memory, or even running out of memory.\n\nThis issue
  has been fixed in #212 by changing the logic for deallocating nodes to ensure that
  all of a node's memory chunks are deallocated. Tests have been added to prevent
  regressions of this nature moving forward.\n\n**Note:** Users of stable-structure
  < 0.6.0 are not affected."
date: "2024-12-04"
pubdate: "2024-05-21"
affected_range: ">=0.6.0 <0.6.4"
fixed_versions:
- "0.6.4"
affected_versions: "All versions starting from 0.6.0 before 0.6.4"
not_impacted: "All versions before 0.6.0, all versions starting from 0.6.4"
solution: "Upgrade to version 0.6.4 or above."
urls:
- "https://nvd.nist.gov/vuln/detail/CVE-2024-4435"
- "https://github.com/advisories/GHSA-3rcq-39xp-7xjp"
- "https://github.com/dfinity/stable-structures/security/advisories/GHSA-3rcq-39xp-7xjp"
- "https://github.com/dfinity/stable-structures/pull/212"
- "https://github.com/dfinity/stable-structures/commit/4f6b8ae521884833498bae26369c353c10f28ea7"
- "https://docs.rs/ic-stable-structures/0.6.4/ic_stable_structures"
- "https://github.com/dfinity/stable-structures"
- "https://internetcomputer.org/docs/current/developer-docs/smart-contracts/maintain/storage#stable-memory"
- "https://rustsec.org/advisories/RUSTSEC-2024-0406.html"
cvss_v3: "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:N/I:N/A:H"
uuid: "d2561e17-8ccc-4662-ac4f-e7ded0119ee2"
cwe_ids:
- "CWE-401"
- "CWE-937"
- "CWE-1035"
