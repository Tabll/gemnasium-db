---
identifier: "CVE-2023-27477"
identifiers:
- "CVE-2023-27477"
- "GHSA-xm67-587q-r2vw"
package_slug: "cargo/cranelift-codegen"
title: "wasmtime vulnerable to miscompilation of `i8x16.select` with the same inputs
  on x86_64"
description: "Wasmtime's code generation backend, Cranelift, has a bug on x86_64 platforms
  for the WebAssembly `i8x16.select` instruction which will produce the wrong results
  when the same operand is provided to the instruction and some of the selected indices
  are greater than 16. There is an off-by-one error  in the calculation of the mask
  to the `pshufb` instruction which causes incorrect results to be returned if lanes
  are selected from the second vector.\n\nThe impact of this miscompilation is that
  the WebAssembly instruction can produce incorrect results for the `i8x16.select`
  instruction. This should have no effect on embedders and does not represent a sandbox
  escape, for example. Guest programs, however, may behave unexpectedly due to the
  incorrect result of this instruction. In extreme cases if a guest program is handling
  untrusted input then the guest program may deviate from its intended execution,
  for example calling an imported host function with different arguments than intended.
  This still does not impact embedders, however, because there is no form of privilege
  escalation with the guest.\n\nAt this time it's expected that this codegen pattern
  doesn't show up in the wild that often. LLVM-generated modules, for example, do
  not appear to conventionally or idiomatically generate code which would hit this
  bug. It is possible, however, to still write code which triggers this, so it's recommended
  for embedders to analyze existing modules to see if any are affected."
date: "2023-03-09"
pubdate: "2023-03-09"
affected_range: ">=0.88.0 <0.91.1||>=0.92.0 <0.92.1||>=0.93.0 <0.93.1"
fixed_versions:
- "0.91.1"
- "0.92.1"
- "0.93.1"
affected_versions: "All versions starting from 0.88.0 before 0.91.1, all versions
  starting from 0.92.0 before 0.92.1, all versions starting from 0.93.0 before 0.93.1"
not_impacted: "All versions before 0.88.0, all versions starting from 0.91.1 before
  0.92.0, all versions starting from 0.92.1 before 0.93.0, all versions starting from
  0.93.1"
solution: "Upgrade to versions 0.91.1, 0.92.1, 0.93.1 or above."
urls:
- "https://nvd.nist.gov/vuln/detail/CVE-2023-27477"
- "https://github.com/advisories/GHSA-xm67-587q-r2vw"
- "https://github.com/bytecodealliance/wasmtime/security/advisories/GHSA-xm67-587q-r2vw"
- "https://github.com/bytecodealliance/wasmtime/commit/5dc2bbccbb363e474d2c9a1b8e38a89a43bbd5d1"
- "https://docs.rs/wasmtime/latest/wasmtime/struct.Config.html#method.wasm_simd"
- "https://github.com/bytecodealliance/wasmtime"
- "https://github.com/webassembly/simd"
- "https://groups.google.com/a/bytecodealliance.org/g/sec-announce/c/Mov-ItrNJsQ"
cvss_v3: "CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:U/C:N/I:L/A:N"
uuid: "a50ca250-39d1-4910-88ac-ad2feeb4f326"
cwe_ids:
- "CWE-193"
- "CWE-937"
- "CWE-1035"
