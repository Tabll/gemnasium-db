---
identifier: "CVE-2022-31146"
identifiers:
- "CVE-2022-31146"
- "GHSA-5fhj-g3p3-pq9g"
package_slug: "cargo/cranelift-codegen"
title: "Wasmtime vulnerable to Use After Free with `externref`s"
description: "There is a bug in Wasmtime's code generator, Cranelift, where functions
  using reference types may be incorrectly missing metadata required for runtime garbage
  collection (GC). This means that if a GC happens at runtime then the collector will
  mistakenly think some Wasm stack frames do not have live references to garbage collected
  values and therefore reclaim and deallocate them. The function can then subsequently
  continue to use the values, leading later to use-after-free bugs. This bug was introduced
  in Cranelift's migration to the `regalloc2` register allocator in the Wasmtime 0.37.0
  release on 2022-05-20. This bug has been patched and users should upgrade to Wasmtime
  version 0.38.2.\n\nMitigations for this issue can be achieved by doing one of:"
date: "2025-05-02"
pubdate: "2022-07-20"
affected_range: ">=0.84.0 <0.85.2"
fixed_versions:
- "0.85.2"
affected_versions: "All versions starting from 0.84.0 before 0.85.2"
not_impacted: "All versions before 0.84.0, all versions starting from 0.85.2"
solution: "Upgrade to version 0.85.2 or above."
urls:
- "https://nvd.nist.gov/vuln/detail/CVE-2022-31146"
- "https://github.com/advisories/GHSA-5fhj-g3p3-pq9g"
- "https://github.com/bytecodealliance/wasmtime/security/advisories/GHSA-5fhj-g3p3-pq9g"
- "https://github.com/bytecodealliance/wasmtime/commit/2ba4bce5cc719e5a74e571a534424614e62ecc41"
- "https://github.com/WebAssembly/reference-types"
- "https://github.com/bytecodealliance/wasmtime"
- "https://rustsec.org/advisories/RUSTSEC-2022-0100.html"
cvss_v3: "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H"
uuid: "7b447332-6f16-4be2-8f61-b395e6da87ce"
cwe_ids:
- "CWE-416"
- "CWE-937"
- "CWE-1035"
