---
identifier: "CVE-2023-34252"
identifiers:
- "GHSA-96xv-rmwj-6p9w"
- "CVE-2023-34252"
package_slug: "packagist/getgrav/grav"
title: "Improper Control of Generation of Code ('Code Injection')"
description: "Grav is a file-based Web platform. Prior to version 1.7.42, there is
  a logic flaw in the `GravExtension.filterFilter()` function whereby validation against
  a denylist of unsafe functions is only performed when the argument passed to filter
  is a string. However, passing an array as a callable argument allows the validation
  check to be skipped. Consequently, a low privileged attacker with login access to
  Grav Admin panel and page creation/update permissions is able to inject malicious
  templates to obtain remote code execution. The vulnerability can be found in the
  `GravExtension.filterFilter()` function declared in `/system/src/Grav/Common/Twig/Extension/GravExtension.php`.
  Version 1.7.42 contains a patch for this issue. End users should also ensure that
  `twig.undefined_functions` and `twig.undefined_filters` properties in `/path/to/webroot/system/config/system.yaml`
  configuration file are set to `false` to disallow Twig from treating undefined filters/functions
  as PHP functions and executing them."
date: "2023-07-01"
pubdate: "2023-06-16"
affected_range: "<1.7.42"
fixed_versions:
- "1.7.42"
affected_versions: "All versions before 1.7.42"
not_impacted: "All versions starting from 1.7.42"
solution: "Upgrade to version 1.7.42 or above."
urls:
- "https://github.com/getgrav/grav/security/advisories/GHSA-96xv-rmwj-6p9w"
- "https://nvd.nist.gov/vuln/detail/CVE-2023-34252"
- "https://github.com/getgrav/grav/commit/244758d4383034fe4cd292d41e477177870b65ec"
- "https://github.com/getgrav/grav/commit/71bbed12f950de8335006d7f91112263d8504f1b"
- "https://github.com/getgrav/grav/commit/8c2c1cb72611a399f13423fc6d0e1d998c03e5c8"
- "https://github.com/getgrav/grav/commit/9d01140a63c77075ef09b26ef57cf186138151a5"
- "https://github.com/getgrav/grav/blob/1.7.40/system/src/Grav/Common/Twig/Extension/GravExtension.php#L1692-L1698"
- "https://github.com/getgrav/grav/blob/1.7.40/system/src/Grav/Common/Utils.php#L1956-L2074"
- "https://github.com/advisories/GHSA-96xv-rmwj-6p9w"
cvss_v3: "CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H"
uuid: "8b2b2a5f-225b-4873-84bb-d1f9d3f22090"
cwe_ids:
- "CWE-1035"
- "CWE-78"
- "CWE-937"
- "CWE-94"
